<!-- HTML header for doxygen 1.8.17-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Morse Micro IoT SDK: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="style.css" rel="stylesheet" type="text/css"/>
<link rel="shortcut icon" href="favicon.svg" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Morse Micro IoT SDK
   &#160;<span id="projectnumber">2.8.2-esp32</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('GETTING_STARTED.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Getting Started </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md__root_workspace_build_mhs_binaries_mhs_res_doc_esp32_gettingstarted_esp32"></a></p>
<p >This getting started guide walks through the process of using the MM-IoT-SDK Framework. This will go through the process of setting up the software infrastructure, building firmware for ESP32S3, and loading it onto the device.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Prerequisites</h1>
<ul>
<li>The Morse Micro IoT SDK software package</li>
<li>One of <a class="el" href="MMPLATFORMS.html">Morse Micro IoT Reference Platform for ESP32</a></li>
<li>A development PC with the ESP-IDF installed.<ul>
<li>For installation details see <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/get-started/linux-macos-setup.html">ESP-IDF Get Started</a></li>
<li>Ensure that your install version <code>v5.1.1</code> as this is the version that is currently supported by the MM-IoT-SDK. This is done by checking out the appropriate tag before running the install script. See <a href="https://docs.espressif.com/projects/esp-idf/en/latest/esp32/versions.html">ESP-IDF Versions</a> for more information on the topic.<ul>
<li>From inside the esp32-idf repository run:</li>
<li><code>git checkout v5.1.1</code></li>
<li><code>git submodule update --init --recursive</code></li>
</ul>
</li>
<li>Make sure to install support for <code>esp32s3</code> by executing <code>./install.sh esp32s3</code> from the <code>esp-idf</code> directory during installation.</li>
</ul>
</li>
</ul>
<blockquote class="doxtable">
<p >&zwj;Note that these instructions were tested on Ubuntu 22.04. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md3"></a>
Setting up the environment</h1>
<p >From the directory where IDF is installed execute the following command to export IDF variables to the environment: </p><pre class="fragment">. ./export.sh
</pre><p> Additionally we need to add an environment variable, <code>MMIOT_ROOT</code>. This allows the ESP-IDF to find the MM-IoT-SDK components when building. This can be done by running: </p><pre class="fragment">export MMIOT_ROOT=&lt;path&gt;/mm-iot-sdk-&lt;VER&gt;
</pre><p> Replace <code>&lt;path&gt;</code> and <code>ver</code> with the appropriate value for your install. Ensure this is an absolute path. You can add the above line to your ~/.bashrc or ~/zshrc (depending on which shell you use) for a more permanent solution.</p>
<h1><a class="anchor" id="autotoc_md4"></a>
Unpacking the software package</h1>
<p >The first step is to create an appropriate directory and unzip the software package into it. For example: </p><pre class="fragment">unzip mm-iot-sdk-&lt;VER&gt;.zip -d mm-iot-sdk-&lt;VER&gt;
cd mm-iot-sdk-&lt;VER&gt;
</pre><p> Where <code>&lt;VER&gt;</code>= is the package version number.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Package contents</h1>
<p >The following is a brief overview of the contents of the MM-IoT-SDK package as it relates to using the framework. There are additional files that are used for PlatformIO that we will be ignoring.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Path   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>framework/doc/</code>   </td><td class="markdownTableBodyNone">HTML documentation, including Getting Started Guide and API documentation    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>framework/mk/</code>   </td><td class="markdownTableBodyNone">Makefile fragments for the various SDK components (not used when building using IDF)    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>framework/morsefirmware/</code>   </td><td class="markdownTableBodyNone">Firmware and board configuration files for supported Morse Micro chips and modules    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>framework/morselib/</code>   </td><td class="markdownTableBodyNone">Headers and .a files for morselib. <code>Libraries can be found under morselib/lib/&lt;architecture&gt;</code>    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone"><code>framework/src/mm_shims/</code>   </td><td class="markdownTableBodyNone">Source code for Hardware Abstraction Layer shims, Operating System abstraction layer shim, etc.    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone"><code>examples/</code>   </td><td class="markdownTableBodyNone">Example applications in source form.   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md6"></a>
AP configuration</h1>
<p >This version of the IoT SDK has been tested against Morse Micro AP with software version 1.9.3. It is assumed that you have this configured and within range of your <a class="el" href="MMPLATFORMS.html">Morse Micro IoT Reference Platform for ESP32</a>.</p>
<h1><a class="anchor" id="BUILDING_FIRMWARE"></a>
Building  firmware</h1>
<p >This SDK includes several example applications, source code for which can be found in the <code>mm-iot-sdk-&lt;VER&gt;/examples/&lt;example&gt;</code> directory.</p>
<p >To build the examples:</p>
<p >First change into the example directory (e.g., examples/porting_assistant) </p><pre class="fragment">cd examples/porting_assistant
</pre><p> For the scan and sta_connect examples it is necessary to make a small source code modification to set the country code to that of the applicable regulatory domain. Edit the source code in <code>main/src/scan.c</code> or <code>main/src/sta_connect.c</code> and uncomment the following line, changing AU to the appropriate two character country code: </p><pre class="fragment">// #define COUNTRY_CODE "AU"
</pre><p> Now it possible to build the firmware by executing the following commands </p><pre class="fragment">idf.py set-target esp32s3
idf.py fullclean
idf.py build
</pre> <h1><a class="anchor" id="autotoc_md7"></a>
Component Configuration</h1>
<p >Some of the components delivered as part of the MM-IoT-SDK may require some configuration. For this the (Kconfig system)[<a href="https://docs.espressif.com/projects/esp-idf/en/v5.1.1/esp32s3/api-reference/kconfig.html">https://docs.espressif.com/projects/esp-idf/en/v5.1.1/esp32s3/api-reference/kconfig.html</a>] supplied as part of the ESP-IDF. To access this run the following command in your project. </p><pre class="fragment">idf.py menuconfig
</pre> <h2><a class="anchor" id="autotoc_md8"></a>
Morse Micro Shim Configuration</h2>
<p >The configuration options are located in <code>(Top) → Component config → Morse Micro Shim Configuration</code></p>
<p >This components allows you to configure:</p><ul>
<li>The pins used to communicate with the Morse Micro chip</li>
<li>Board Configuration File (BCF) to link against</li>
</ul>
<h3><a class="anchor" id="autotoc_md9"></a>
Board Configuration File</h3>
<p >The Board Configuration File (BCF) is a configuration file for the Morse Micro chip that provides board-specific information and is required for the system to function properly. BCFs for Morse Micro modules are included in the MM-IoT-SDK package. These modules can be identified by the part numbers printed on their labels, which take the form MM6108-MFxxxxxx.</p>
<h1><a class="anchor" id="autotoc_md10"></a>
Programming</h1>
<p >Execute the following commands to load the firmware to the ESP32 and start a serial monitor: </p><pre class="fragment">idf.py -p /dev/ttyACM0 flash monitor
</pre> <blockquote class="doxtable">
<p >&zwj;Note: substitute <code>/dev/ttyACM0</code> for the appropriate device name. </p>
</blockquote>
<h1><a class="anchor" id="autotoc_md11"></a>
Example Applications</h1>
<h2><a class="anchor" id="autotoc_md12"></a>
Porting Assistant example</h2>
<p >The porting assistant example runs through a variety of tests to provide initial validation of HAL implementation. Verifiation includes checking whether it is possible to communicate with the device via SPI. Expected output of this application is as follows:</p>
<div class="fragment"><div class="line">MM-IoT-SDK Porting Assistant</div>
<div class="line">----------------------------</div>
<div class="line"> </div>
<div class="line">Memory allocation                                            [ PASS ]</div>
<div class="line">Memory reallocation                                          [ PASS ]</div>
<div class="line">Passage of time                                              [ PASS ]</div>
<div class="line">Task creation and preemption                                 [ PASS ]</div>
<div class="line">WLAN HAL initialisation                                      I (513) gpio: GPIO[3]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (523) gpio: GPIO[8]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (533) gpio: GPIO[10]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (543) gpio: GPIO[9]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 1| Intr:1</div>
<div class="line">I (543) gpio: GPIO[21]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:2</div>
<div class="line"> </div>
<div class="line">Hard reset device</div>
<div class="line">Send training sequence</div>
<div class="line">Check for MM chip ready for SDIO/SPI commands                [ PASS ]</div>
<div class="line">Put MM chip into SPI mode                                    [ PASS ]</div>
<div class="line">Validate MM firmware                                         [ PASS ]</div>
<div class="line">Validate BCF                                                 [ PASS ]</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">11 total test steps. 8 passed, 0 failed, 3 no result, 0 skipped</div>
<div class="line">I (803) main_task: Returned from app_main()</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md13"></a>
Scan example</h2>
<p >The scan example performs a scan for access points (APs) and displays the results. Output of this application will vary depending on the APs in range but will look something like the following...</p>
<div class="fragment"><div class="line">Morse Scan Demo (Built Aug  9 2023 17:39:12)</div>
<div class="line"> </div>
<div class="line">I (445) gpio: GPIO[3]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (455) gpio: GPIO[8]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (465) gpio: GPIO[10]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (475) gpio: GPIO[9]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 1| Intr:1</div>
<div class="line">I (485) gpio: GPIO[21]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:2</div>
<div class="line">Morse firmware version rel_1_9_1_2023_Aug_07, morselib version bccf2e03c, Morse chip ID 0x206</div>
<div class="line"> </div>
<div class="line">Scan started on AU channels, Waiting for results...</div>
<div class="line">I (1945) main_task: Returned from app_main()</div>
<div class="line"> 1. RSSI: -32, BSSID: 0c:bf:74:8b:72:62, Beacon Interval(TUs):   100, Capability Info: 0x0011, SSID: MorseMicro</div>
<div class="line">Scanning completed.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md14"></a>
STA Connect example</h2>
<p >The STA Connect example demonstrates how to connect as a station (STA) to an AP. For this example to operate it requires that an AP be available to connect to and that the SSID and passphrase of the AP match the <code>#define</code>s in the source file <code>main/src/sta_connect.c</code>.</p>
<p >This example application will first establish connection then will send an ARP request for IP address 192.168.1.1. It will also print information about any received packets.</p>
<p >Output will vary depending on the AP configuration, but should look something like the following...</p>
<div class="fragment"><div class="line">Morse STA Demo (Built Aug  9 2023 17:42:35)</div>
<div class="line"> </div>
<div class="line">I (446) gpio: GPIO[3]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (456) gpio: GPIO[8]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (466) gpio: GPIO[10]| InputEn: 0| OutputEn: 1| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:0</div>
<div class="line">I (476) gpio: GPIO[9]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 1| Intr:1</div>
<div class="line">I (486) gpio: GPIO[21]| InputEn: 1| OutputEn: 0| OpenDrain: 0| Pullup: 0| Pulldown: 0| Intr:2</div>
<div class="line">Morse firmware version rel_1_9_1_2023_Aug_07, morselib version bccf2e03c, Morse chip ID 0x206</div>
<div class="line"> </div>
<div class="line">STA state: CONNECTING (1)</div>
<div class="line">Link went Up</div>
<div class="line">STA state: CONNECTED (2)</div>
<div class="line">I (7476) main_task: Returned from app_main()</div>
<div class="line">RX from 0c:bf:74:8b:72:62 type 0x0806</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md15"></a>
Notes</h1>
<p >Each of the example applications provides an <code>sdkconfig.defaults</code> that is used to set the FreeRTOS tick rate to 1 kHz. This is necessary for the MM IoT SDK to operate properly. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.17-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Copyright 2021 Morse Micro </li>
  </ul>
</div>
</body>
</html>
